<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Helvetica', 'Arial', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .section h2 {
            font-size: 24px;
            font-weight: 600;
            margin-top: 0;
            color: #333;
        }
        .section p {
            font-size: 16px;
            line-height: 1.6;
            color: #555;
        }
        .metric {
            display: inline-block;
            width: 200px;
            margin: 10px;
        }
        .metric h3 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        .schedule-item, .milestone-item {
            font-size: 16px;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .schedule-item:last-child, .milestone-item:last-child {
            border-bottom: none;
        }
        button {
            padding: 8px 16px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button.primary {
            background-color: #007bff;
            color: #fff;
        }
        button.primary:hover {
            background-color: #0056b3;
        }
        button.cancel {
            background-color: #dc3545;
            color: #fff;
        }
        button.cancel:hover {
            background-color: #b02a37;
        }
        .chart-container {
            width: 1000px;
            max-width: 100%;
            margin: 30px auto;
        }
        .stats-form {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .stats-form p {
            margin: 0;
            flex: 1 1 200px;
        }
        .stats-form input {
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 100px;
        }
        .stats-form button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="section">
            <h2>Performance Dashboard</h2>
            <button class="primary" onclick="showForm()">Update Stats</button>
            <div id="statsForm" style="display: none;">
                <h3>Enter Your Stats</h3>
                <div class="stats-form">
                    <p>Body Weight (kg): <input type="number" id="bodyWeight" value="92"></p>
                    <p>Testosterone (ng/dL): <input type="number" id="testosterone" disabled></p>
                    <p>Daily Calories (kcal): <input type="number" id="calories" value="520"></p>
                    <button class="cancel" onclick="cancelForm()">Cancel</button>
                    <button class="primary" onclick="saveForm()">Save</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Progress Tracking</h2>
            <div class="chart-container">
                <canvas id="testosteroneChart"></canvas>
                <p id="testosteroneChartNote">Chart shows testosterone from last injection to end of 4-week cycle. Weekly markers at Days 0, 7, 14, 21, 28.</p>
            </div>
            <div class="chart-container">
                <canvas id="fatLossChart"></canvas>
                <p>Chart shows projected fat loss from last injection to end of 4-week cycle based on current weight and calorie deficit. Weekly markers at Days 0, 7, 14, 21, 28.</p>
            </div>
        </div>

        <div class="section">
            <h2>Combined Benefits</h2>
            <p id="combinedBenefits">TRT (17 weeks) + low-calorie diet (520–800 kcal/day: morning juice, protein shake, low/no sugar, low/no carb dinner) + 6x/week resistance training sustains testosterone at ~800–1700 ng/dL, driving 2.2–2.4 kg/week fat loss (2365–2645 kcal deficit). Benefits include muscle preservation, strength gains, focus, energy, sleep, libido, mood, and insulin sensitivity.</p>
        </div>

        <div class="section">
            <h2>Performance Metrics</h2>
            <div class="metric">
                <h3>Testosterone</h3>
                <p id="testosteroneLevel">~1708 ng/dL</p>
                <p id="daysSinceInjection">Day 5 since last injection (03/08/2025); adjust with bloodwork</p>
            </div>
        </div>

        <div class="section">
            <h2>TRT Schedule</h2>
            <div id="trtSchedule"></div>
        </div>

        <div class="section">
            <h2>Milestones</h2>
            <div class="milestone-item">1 kg Fat Lost</div>
            <div class="milestone-item">Injection #3 Complete (21/05/2025) ✓ Completed!</div>
            <div class="milestone-item">Injection #4 Complete (25/06/2025) ✓ Completed!</div>
            <div class="milestone-item">5 kg Fat Lost</div>
            <div class="milestone-item">Halfway Through TRT (23/07/2025) ⏳</div>
            <div class="milestone-item">10 kg Fat Lost</div>
        </div>

        <div class="section">
            <h2>Health Tips</h2>
            <p>Monitor bloodwork regularly (hematocrit, PSA, lipids, liver function) due to high peak testosterone (~1902 ng/dL). Ensure 147–202 g protein/day. Consider 2100–2600 kcal/day for sustainable fat loss.</p>
        </div>

        <div class="section">
            <p id="footerNote">Shared for Us - NSW Time | Last Injection: 03/08/2025 | Check bloods after July 2025</p>
            <button class="primary">Export Data</button>
        </div>
    </div>

    <script>
        // Initialize variables
        let currentWeight = 92; // Default weight
        let fatLossChartInstance = null; // Store fat loss chart instance

        // Injection schedule
        const injections = [
            { date: '2025-03-12', dose: 1000, completed: true },
            { date: '2025-04-16', dose: 1000, completed: true },
            { date: '2025-05-21', dose: 1000, completed: true },
            { date: '2025-06-25', dose: 1000, completed: true },
            { date: '2025-08-03', dose: 1000, completed: true },
            { date: '2025-08-31', dose: 1000, completed: false },
            { date: '2025-09-28', dose: 1000, completed: false },
            { date: '2025-10-26', dose: 1000, completed: false }
        ];

        // Show/hide stats form
        function showForm() {
            document.getElementById('statsForm').style.display = 'block';
        }

        function cancelForm() {
            document.getElementById('statsForm').style.display = 'none';
        }

        function saveForm() {
            // Save updated stats
            currentWeight = parseFloat(document.getElementById('bodyWeight').value) || 92;
            localStorage.setItem('bodyWeight', currentWeight);
            alert('Stats saved!');
            document.getElementById('statsForm').style.display = 'none';
            // Recalculate and update charts
            updateCharts();
        }

        // Calculate testosterone levels and fat loss
        function updateCharts() {
            // Use dynamic current date
            const currentDate = new Date();
            const halfLife = 27; // days
            const baselineTestosterone = 300; // ng/dL
            const peakContribution = 1000; // ng/dL per 1000 mg injection

            // Update injection completion status
            injections.forEach(injection => {
                const injectionDate = new Date(injection.date);
                injection.completed = injectionDate <= currentDate;
            });

            // Calculate testosterone for current date
            let totalTestosterone = baselineTestosterone;
            let lastInjectionDate = null;
            let daysSinceLast = 0;

            injections.forEach(injection => {
                const injectionDate = new Date(injection.date);
                const daysSince = (currentDate - injectionDate) / (1000 * 60 * 60 * 24);
                if (daysSince >= 0 && injection.completed) {
                    const contribution = peakContribution * Math.exp(-Math.log(2) * daysSince / halfLife);
                    totalTestosterone += contribution;
                    if (!lastInjectionDate || injectionDate > lastInjectionDate) {
                        lastInjectionDate = injectionDate;
                        daysSinceLast = daysSince;
                    }
                }
            });

            // Format date in DD/MM/YYYY
            const formattedDate = lastInjectionDate ? lastInjectionDate.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }).split('/').join('/') : 'N/A';

            // Update DOM for testosterone
            document.getElementById('testosteroneLevel').textContent = `~${Math.round(totalTestosterone)} ng/dL`;
            document.getElementById('daysSinceInjection').textContent = `Day ${Math.floor(daysSinceLast)} since last injection (${formattedDate}); adjust with bloodwork`;
            document.getElementById('testosterone').value = Math.round(totalTestosterone);

            // Update TRT schedule display
            const trtSchedule = document.getElementById('trtSchedule');
            trtSchedule.innerHTML = '';
            injections.forEach((injection, index) => {
                const injectionDate = new Date(injection.date);
                const formattedInjectionDate = injectionDate.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }).split('/').join('/');
                const status = injection.completed ? '✓' : '⏳';
                const div = document.createElement('div');
                div.className = 'schedule-item';
                div.textContent = `${formattedInjectionDate} - Injection #${index + 1} - ${injection.dose} mg ${status}`;
                trtSchedule.appendChild(div);
            });

            // Update footer note
            document.getElementById('footerNote').textContent = `Shared for Us - NSW Time | Last Injection: ${formattedDate} | Check bloods after July 2025`;

            // Find latest completed injection for chart start date
            const latestInjection = injections.filter(inj => inj.completed).reduce((latest, inj) => {
                const injDate = new Date(inj.date);
                return !latest || injDate > new Date(latest.date) ? inj : latest;
            }, null);
            const startDate = latestInjection ? new Date(latestInjection.date) : new Date('2025-08-03');

            // Calculate days since start date for current day index
            const currentDayIndex = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));

            // Generate data for testosterone chart
            const testosteroneData = [];
            const chartLabels = [];
            const weeklyMarkers = [0, 7, 14, 21, 28]; // Days for weekly markers
            const testosteroneWeeklyData = Array(29).fill(null); // Null except at weekly markers
            for (let i = 0; i <= 28; i++) {
                const currentDay = new Date(startDate);
                currentDay.setDate(startDate.getDate() + i);
                let testosterone = baselineTestosterone;
                injections.forEach(injection => {
                    const injectionDate = new Date(injection.date);
                    const daysSince = (currentDay - injectionDate) / (1000 * 60 * 60 * 24);
                    if (daysSince >= 0 && injection.completed) {
                        testosterone += peakContribution * Math.exp(-Math.log(2) * daysSince / halfLife);
                    }
                });
                testosteroneData.push(Math.round(testosterone));
                if (weeklyMarkers.includes(i)) {
                    testosteroneWeeklyData[i] = Math.round(testosterone);
                }
                chartLabels.push(currentDay.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit' }).split('/').join('/'));
            }

            // Update testosterone chart note
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 28);
            const formattedEndDate = endDate.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }).split('/').join('/');
            const nextInjection = injections.find(inj => new Date(inj.date) > startDate && !inj.completed);
            const nextInjectionDate = nextInjection ? new Date(nextInjection.date).toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }).split('/').join('/') : 'N/A';
            document.getElementById('testosteroneChartNote').textContent = `Chart shows testosterone from last injection (${formattedDate}) to end of 4-week cycle (${formattedEndDate}). Next injection: ${nextInjectionDate}. Weekly markers at Days 0, 7, 14, 21, 28.`;

            // Render testosterone chart
            const testosteroneCtx = document.getElementById('testosteroneChart').getContext('2d');
            new Chart(testosteroneCtx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Testosterone (ng/dL)',
                        data: testosteroneData,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.3)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.5
                    }, {
                        label: 'Current Day',
                        data: testosteroneData.map((val, idx) => idx === currentDayIndex ? val : null),
                        backgroundColor: 'rgba(255, 99, 132, 1)',
                        pointRadius: 10,
                        pointHoverRadius: 12,
                        showLine: false
                    }, {
                        label: 'Weekly Markers',
                        data: testosteroneWeeklyData,
                        backgroundColor: 'rgba(0, 123, 255, 1)',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointStyle: 'triangle',
                        showLine: false
                    }]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Testosterone Levels',
                            font: { size: 18 },
                            padding: { top: 10, bottom: 10 }
                        },
                        legend: { labels: { font: { size: 14 } } },
                        tooltip: { titleFont: { size: 14 }, bodyFont: { size: 14 } }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Date (DD/MM)', font: { size: 16 } },
                            ticks: { maxTicksLimit: 10, font: { size: 14 } },
                            grid: { color: 'rgba(0, 0, 0, 0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'Testosterone (ng/dL)', font: { size: 16 } },
                            suggestedMin: 0,
                            suggestedMax: 2000,
                            ticks: { font: { size: 14 } },
                            grid: { color: 'rgba(0, 0, 0, 0.1)' }
                        }
                    }
                }
            });

            // Calculate fat loss
            const height = 180; // cm
            const age = 43; // years
            const activityFactor = 1.725; // High activity (6x/week training)
            const calorieIntakeLow = 520; // kcal/day
            const calorieIntakeHigh = 800; // kcal/day

            // Calculate BMR and TDEE
            const bmr = 10 * currentWeight + 6.25 * height - 5 * age + 5;
            const tdee = bmr * activityFactor;

            // Calculate deficit and fat loss
            const deficitLow = tdee - calorieIntakeHigh;
            const deficitHigh = tdee - calorieIntakeLow;
            const weeklyDeficitLow = deficitLow * 7;
            const weeklyDeficitHigh = deficitHigh * 7;
            const weeklyFatLossLow = weeklyDeficitLow / 7700; // kg/week
            const weeklyFatLossHigh = weeklyDeficitHigh / 7700; // kg/week
            const weeklyFatLossMid = (weeklyFatLossLow + weeklyFatLossHigh) / 2;
            const dailyFatLoss = weeklyFatLossMid / 7; // kg/day

            // Generate data for fat loss chart
            const fatLossData = [];
            const fatLossWeeklyData = Array(29).fill(null); // Null except at weekly markers
            const startWeight = currentWeight + (currentDayIndex * dailyFatLoss); // Weight at start of chart
            for (let i = 0; i <= 28; i++) {
                const weight = startWeight - (i * dailyFatLoss);
                fatLossData.push(weight.toFixed(1));
                if (weeklyMarkers.includes(i)) {
                    fatLossWeeklyData[i] = weight.toFixed(1);
                }
            }

            // Update Combined Benefits
            const fatLossRange = `${weeklyFatLossLow.toFixed(1)}–${weeklyFatLossHigh.toFixed(1)}`;
            const deficitRange = `${deficitLow.toFixed(0)}–${deficitHigh.toFixed(0)}`;
            document.getElementById('combinedBenefits').textContent = `TRT (17 weeks) + low-calorie diet (520–800 kcal/day: morning juice, protein shake, low/no sugar, low/no carb dinner) + 6x/week resistance training sustains testosterone at ~800–1700 ng/dL, driving ${fatLossRange} kg/week fat loss (${deficitRange} kcal deficit). Benefits include muscle preservation, strength gains, focus, energy, sleep, libido, mood, and insulin sensitivity.`;

            // Destroy existing fat loss chart if it exists
            if (fatLossChartInstance) {
                fatLossChartInstance.destroy();
            }

            // Render fat loss chart
            const fatLossCtx = document.getElementById('fatLossChart').getContext('2d');
            fatLossChartInstance = new Chart(fatLossCtx, {
                type: 'line',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Weight (kg)',
                        data: fatLossData,
                        borderColor: 'rgba(153, 102, 255, 1)',
                        backgroundColor: 'rgba(153, 102, 255, 0.3)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.5
                    }, {
                        label: 'Current Day',
                        data: fatLossData.map((val, idx) => idx === currentDayIndex ? val : null),
                        backgroundColor: 'rgba(255, 99, 132, 1)',
                        pointRadius: 10,
                        pointHoverRadius: 12,
                        showLine: false
                    }, {
                        label: 'Weekly Markers',
                        data: fatLossWeeklyData,
                        backgroundColor: 'rgba(0, 123, 255, 1)',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointStyle: 'triangle',
                        showLine: false
                    }]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Projected Weight Loss',
                            font: { size: 18 },
                            padding: { top: 10, bottom: 10 }
                        },
                        legend: { labels: { font: { size: 14 } } },
                        tooltip: { titleFont: { size: 14 }, bodyFont: { size: 14 } }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Date (DD/MM)', font: { size: 16 } },
                            ticks: { maxTicksLimit: 10, font: { size: 14 } },
                            grid: { color: 'rgba(0, 0, 0, 0.1)' }
                        },
                        y: {
                            title: { display: true, text: 'Weight (kg)', font: { size: 16 } },
                            suggestedMin: 80,
                            suggestedMax: 95,
                            ticks: { font: { size: 14 } },
                            grid: { color: 'rgba(0, 0, 0, 0.1)' }
                        }
                    }
                }
            });
        }

        // Load saved weight and initialize charts on page load
        window.onload = function() {
            const savedWeight = localStorage.getItem('bodyWeight');
            if (savedWeight) {
                currentWeight = parseFloat(savedWeight);
                document.getElementById('bodyWeight').value = currentWeight;
            }
            updateCharts();
        };
    </script>
</body>
</html>